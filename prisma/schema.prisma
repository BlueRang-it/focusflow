// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../node_modules/@prisma/client/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

// ==========================================
// USER & AUTHENTICATION MODELS
// ==========================================

model User {
  id                    String    @id @default(cuid())
  email                 String    @unique
  name                  String?
  password              String?
  profileImage          String?
  bio                   String?
  
  // Profile & Preferences
  workStartTime         String    @default("09:00") // HH:mm format
  workEndTime           String    @default("17:00")
  timezone              String    @default("UTC")
  notificationsEnabled  Boolean   @default(true)
  dailyGoal             Int       @default(8) // hours
  weeklyGoal            Int       @default(40) // hours
  
  // Gamification
  xp                    Int       @default(0)
  level                 Int       @default(1)
  streak                Int       @default(0)
  longestStreak         Int       @default(0)
  totalCheckIns         Int       @default(0)
  
  // Relations
  accounts              Account[]
  sessions              Session[]
  tasks                 Task[]
  checkIns              CheckIn[]
  journal               JournalEntry[]
  badges                Badge[]
  achievements          Achievement[]
  milestones            Milestone[]
  notifications         Notification[]
  preferences           UserPreferences?
  analytics             Analytics?
  
  // Advanced Features
  habits                Habit[]
  goals                 Goal[]
  projects              Project[]
  deepWorkBlocks        DeepWorkBlock[]
  timeTrackingEntries   TimeTrackingEntry[]
  moodEntries           MoodEntry[]
  weeklyReviews         WeeklyReview[]
  focusPersonality      FocusPersonality?
  aiCoachSessions       AICoachSession[]
  scheduledTasks        ScheduledTask[]
  calendarEvents        CalendarEvent[]
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("users")
}

model Account {
  id                    String  @id @default(cuid())
  userId                String
  type                  String
  provider              String
  providerAccountId     String
  refresh_token         String?  @db.Text
  access_token          String?  @db.Text
  expires_at            Int?
  token_type            String?
  scope                 String?
  id_token              String?  @db.Text
  session_state         String?

  user                  User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id                    String    @id @default(cuid())
  sessionToken          String    @unique
  userId                String
  expires               DateTime
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier            String
  token                 String    @unique
  expires               DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// ==========================================
// TASK MANAGEMENT
// ==========================================

model Task {
  id                    String    @id @default(cuid())
  userId                String
  
  title                 String
  description           String?   @db.Text
  priority              Priority  @default(MEDIUM)
  status                TaskStatus @default(TODO)
  
  timeEstimate          Int?      // in minutes
  timeSpent             Int       @default(0) // in minutes
  dueDate               DateTime?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  completedAt           DateTime?
  
  projectId             String?
  project               Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)

  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  checkIns              CheckIn[]
  deepWorkBlocks        DeepWorkBlock[]

  @@map("tasks")
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  BLOCKED
  COMPLETED
  CANCELLED
}

// ==========================================
// CHECK-IN SYSTEM
// ==========================================

model CheckIn {
  id                    String    @id @default(cuid())
  userId                String
  taskId                String?
  
  accomplishment        String    @db.Text
  productivityRating    Int       // 1-10 scale
  mood                  Mood      @default(NEUTRAL)
  blockers              String?   @db.Text
  distractions          String?   @db.Text
  notes                 String?   @db.Text
  
  createdAt             DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  task                  Task?     @relation(fields: [taskId], references: [id], onDelete: SetNull)
  
  @@index([userId, createdAt])
  @@map("check_ins")
}

enum Mood {
  VERY_UNHAPPY
  UNHAPPY
  NEUTRAL
  HAPPY
  VERY_HAPPY
}

// ==========================================
// JOURNAL & REFLECTION
// ==========================================

model JournalEntry {
  id                    String    @id @default(cuid())
  userId                String
  
  title                 String?
  content               String    @db.Text
  mood                  Mood      @default(NEUTRAL)
  productivity          Int?      // 1-10 scale
  
  reflectionNotes       String?   @db.Text
  lessonsLearned        String?   @db.Text
  tomorrowPlan          String?   @db.Text
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, createdAt])
  @@map("journal_entries")
}

// ==========================================
// GAMIFICATION & REWARDS
// ==========================================

model Badge {
  id                    String    @id @default(cuid())
  userId                String
  
  name                  String
  description           String?   @db.Text
  icon                  String?
  criterion             String    // e.g., "first_check_in", "7_day_streak"
  
  earnedAt              DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([userId, criterion])
  @@map("badges")
}

model Achievement {
  id                    String    @id @default(cuid())
  userId                String
  
  type                  AchievementType
  title                 String
  description           String?   @db.Text
  xpReward              Int       @default(0)
  
  unlockedAt            DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("achievements")
}

enum AchievementType {
  FIRST_TASK
  FIRST_CHECK_IN
  STREAK_3
  STREAK_7
  STREAK_30
  LEVEL_UP
  TASK_COMPLETION
  PERFECT_PRODUCTIVITY
  CONSISTENCY_WEEK
  CONSISTENCY_MONTH
  MOTIVATIONAL
  CUSTOM
}

model Milestone {
  id                    String    @id @default(cuid())
  userId                String
  
  name                  String
  description           String?   @db.Text
  target                Int       // e.g., tasks completed, check-ins done
  current               Int       @default(0)
  category              String    // e.g., "checkIn", "taskCompletion", "xp"
  
  completedAt           DateTime?
  createdAt             DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("milestones")
}

// ==========================================
// PRODUCTIVITY ANALYTICS
// ==========================================

model Analytics {
  id                    String    @id @default(cuid())
  userId                String    @unique
  
  // Daily metrics
  todayTasksCompleted   Int       @default(0)
  todayCheckIns         Int       @default(0)
  todayAverageRating    Float     @default(0)
  todayHoursLogged      Float     @default(0)
  
  // Weekly metrics
  weekTasksCompleted    Int       @default(0)
  weekCheckIns          Int       @default(0)
  weekAverageRating     Float     @default(0)
  
  // Historical
  totalTasksCompleted   Int       @default(0)
  totalCheckIns         Int       @default(0)
  averageHourlyRating   Float     @default(0)
  peakHour              Int?      // 0-23
  
  lastUpdated           DateTime  @default(now()) @updatedAt
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  dailyStats            DailyStat[]
  
  @@map("analytics")
}

model DailyStat {
  id                    String    @id @default(cuid())
  analyticsId           String
  
  date                  DateTime  @db.Date
  tasksCompleted        Int       @default(0)
  checkInCount          Int       @default(0)
  averageRating         Float     @default(0)
  hoursLogged           Float     @default(0)
  
  analytics             Analytics @relation(fields: [analyticsId], references: [id], onDelete: Cascade)
  
  @@unique([analyticsId, date])
  @@map("daily_stats")
}

// ==========================================
// NOTIFICATIONS & REMINDERS
// ==========================================

model Notification {
  id                    String    @id @default(cuid())
  userId                String
  
  title                 String
  message               String    @db.Text
  type                  NotificationType
  actionUrl             String?
  
  isRead                Boolean   @default(false)
  readAt                DateTime?
  
  createdAt             DateTime  @default(now())
  expiresAt             DateTime?
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, isRead, createdAt])
  @@map("notifications")
}

enum NotificationType {
  CHECK_IN_REMINDER
  TASK_DUE
  FELL_BEHIND
  MOTIVATIONAL
  ACHIEVEMENT
  STREAK_MILESTONE
  DAILY_SUMMARY
  INACTIVITY_ALERT
  CUSTOM
}

model Reminder {
  id                    String    @id @default(cuid())
  userId                String
  
  type                  ReminderType
  scheduledTime         DateTime
  message               String    @db.Text
  isActive              Boolean   @default(true)
  
  createdAt             DateTime  @default(now())
  
  @@map("reminders")
}

enum ReminderType {
  HOURLY_CHECK_IN
  DAILY_MORNING
  DAILY_EVENING
  TASK_DUE
  INACTIVITY
  MOTIVATIONAL
}

// ==========================================
// USER PREFERENCES
// ==========================================

model UserPreferences {
  id                    String    @id @default(cuid())
  userId                String    @unique
  
  // Notification preferences
  enableEmailNotifications Boolean @default(true)
  enablePushNotifications Boolean @default(true)
  enableDailyDigest       Boolean @default(true)
  enableMotivationalMessages Boolean @default(true)
  enableStreakAlerts      Boolean @default(true)
  
  // Productivity preferences
  productivityStyle       String  @default("balanced") // focused, balanced, flexible
  preferredWorkBlocks     Int     @default(90) // minutes
  preferredBreakLength    Int     @default(15) // minutes
  
  // Theme & UI
  theme                   String  @default("light") // light, dark, system
  language                String  @default("en")
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  
  user                    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("user_preferences")
}

// ==========================================
// ADVANCED FEATURE 1: HABIT SYSTEM
// ==========================================

model Habit {
  id                    String    @id @default(cuid())
  userId                String
  goalId                String?
  
  name                  String
  description           String?   @db.Text
  category              String    // Health, Work, Learning, Personal
  frequency             HabitFrequency @default(DAILY) // Daily, Weekly
  targetCount           Int       @default(1) // e.g., 1 exercise per day
  
  currentStreak         Int       @default(0)
  longestStreak         Int       @default(0)
  totalCompleted        Int       @default(0)
  
  isActive              Boolean   @default(true)
  startDate             DateTime  @default(now())
  endDate               DateTime?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  goal                  Goal?     @relation(fields: [goalId], references: [id], onDelete: SetNull)
  logs                  HabitLog[]
  
  @@index([userId, isActive])
  @@map("habits")
}

enum HabitFrequency {
  DAILY
  WEEKLY
  MULTIPLE_TIMES_DAILY
}

model HabitLog {
  id                    String    @id @default(cuid())
  habitId               String
  
  date                  DateTime  @db.Date
  count                 Int       @default(1)
  notes                 String?   @db.Text
  
  habit                 Habit     @relation(fields: [habitId], references: [id], onDelete: Cascade)
  
  @@unique([habitId, date])
  @@map("habit_logs")
}

// ==========================================
// ADVANCED FEATURE 2: GOALS → PROJECTS → TASKS HIERARCHY
// ==========================================

model Goal {
  id                    String    @id @default(cuid())
  userId                String
  
  title                 String
  description           String?   @db.Text
  category              String    // e.g., "Career", "Health", "Learning"
  status                GoalStatus @default(ACTIVE)
  
  targetDate            DateTime?
  priority              Priority  @default(MEDIUM)
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  completedAt           DateTime?
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects              Project[]
  habits                Habit[]
  
  @@index([userId, status])
  @@map("goals")
}

enum GoalStatus {
  ACTIVE
  ON_HOLD
  COMPLETED
  ABANDONED
}

model Project {
  id                    String    @id @default(cuid())
  userId                String
  goalId                String
  
  title                 String
  description           String?   @db.Text
  status                ProjectStatus @default(PLANNING)
  
  startDate             DateTime?
  endDate               DateTime?
  completedAt           DateTime?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  goal                  Goal      @relation(fields: [goalId], references: [id], onDelete: Cascade)
  tasks                 Task[]
  
  @@index([userId, goalId, status])
  @@map("projects")
}

enum ProjectStatus {
  PLANNING
  IN_PROGRESS
  ON_HOLD
  COMPLETED
  CANCELLED
}

// ==========================================
// ADVANCED FEATURE 3: DEEP WORK BLOCKS
// ==========================================

model DeepWorkBlock {
  id                    String    @id @default(cuid())
  userId                String
  taskId                String?
  
  title                 String
  description           String?   @db.Text
  goal                  String    @db.Text
  
  scheduledStart        DateTime
  scheduledEnd          DateTime
  actualStart           DateTime?
  actualEnd             DateTime?
  
  durationPlanned       Int       // in minutes
  durationActual        Int?      // in minutes
  
  focusRating           Int?      // 1-10 scale
  productivityRating    Int?      // 1-10 scale
  
  distractionsLogged    String?   @db.Text
  sessionNotes          String?   @db.Text
  lessonsLearned        String?   @db.Text
  
  isCompleted           Boolean   @default(false)
  
  createdAt             DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  task                  Task?     @relation(fields: [taskId], references: [id], onDelete: SetNull)
  
  @@index([userId, scheduledStart])
  @@map("deep_work_blocks")
}

// ==========================================
// ADVANCED FEATURE 4: TIME TRACKING (RescueTime-style)
// ==========================================

model TimeTrackingEntry {
  id                    String    @id @default(cuid())
  userId                String
  
  applicationName       String?
  windowTitle           String?   @db.Text
  category              ActivityCategory
  subcategory           String?
  
  duration              Int       // in seconds
  timeSpent             Int       // in seconds
  
  isProductive          Boolean
  
  capturedAt            DateTime
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, capturedAt])
  @@map("time_tracking_entries")
}

enum ActivityCategory {
  WORK
  COMMUNICATION
  SOCIAL_MEDIA
  ENTERTAINMENT
  BREAKS
  DEVELOPMENT
  RESEARCH
  ADMINISTRATION
  OTHER
}

// ==========================================
// ADVANCED FEATURE 5: MOOD & MENTAL ENERGY TRACKING
// ==========================================

model MoodEntry {
  id                    String    @id @default(cuid())
  userId                String
  
  mood                  Mood
  mentalEnergy          Int       // 1-10 scale
  physicalEnergy        Int       // 1-10 scale
  stress                Int       // 1-10 scale
  focus                 Int       // 1-10 scale
  
  context               String?   @db.Text // what's happening
  triggers              String?   @db.Text // what caused this mood
  
  burnoutRisk           BurnoutRisk @default(LOW)
  
  recordedAt            DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, recordedAt])
  @@map("mood_entries")
}

enum BurnoutRisk {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

// ==========================================
// ADVANCED FEATURE 6: WEEKLY REVIEWS & PLANNING
// ==========================================

model WeeklyReview {
  id                    String    @id @default(cuid())
  userId                String
  
  weekStartDate         DateTime  @db.Date
  weekEndDate           DateTime  @db.Date
  
  whatWorkedWell        String?   @db.Text
  whatDidntWork         String?   @db.Text
  improvements          String?   @db.Text
  
  tasksCompleted        Int       @default(0)
  averageProductivity   Float     @default(0)
  totalHoursLogged      Float     @default(0)
  
  nextWeekPlan          String?   @db.Text
  priorities            String?   @db.Text
  focusAreas            String?   @db.Text
  
  overallSatisfaction   Int?      // 1-10 scale
  
  generatedInsights     String?   @db.Text // AI-generated insights
  
  createdAt             DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, weekStartDate])
  @@map("weekly_reviews")
}

// ==========================================
// ADVANCED FEATURE 7: FOCUS PERSONALITY ANALYSIS
// ==========================================

model FocusPersonality {
  id                    String    @id @default(cuid())
  userId                String    @unique
  
  // Personality type
  type                  FocusType @default(BALANCED)
  confidence            Float     @default(0.5) // 0-1, how confident we are in this assessment
  
  // Patterns
  bestProductiveHours   String?   // e.g., "09:00-12:00"
  worstProductiveHours  String?   // e.g., "14:00-16:00"
  peakEnergyHour        Int?      // 0-23
  
  preferredBlockLength  Int       @default(90) // minutes
  idealBreakLength      Int       @default(15) // minutes
  
  morningPerson         Boolean   @default(true)
  burstWorker           Boolean   @default(false) // short intense bursts vs sustained
  deepFocusSpecialist   Boolean   @default(false) // prefers long deep blocks
  deadlineDriven        Boolean   @default(false) // performs better under pressure
  
  // Recommendations
  recommendedStructure  String?   @db.Text
  weakSpots             String?   @db.Text
  strengths             String?   @db.Text
  
  dataPointsCollected   Int       @default(0) // how many data points informed this
  lastAnalyzedAt        DateTime?
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("focus_personality")
}

enum FocusType {
  MORNING_PERSON
  BURST_WORKER
  DEEP_FOCUS_SPECIALIST
  DEADLINE_DRIVEN
  BALANCED
  UNKNOWN
}

// ==========================================
// ADVANCED FEATURE 8: AI PRODUCTIVITY COACH
// ==========================================

model AICoachSession {
  id                    String    @id @default(cuid())
  userId                String
  
  sessionType           CoachSessionType
  context               String?   @db.Text // what the user is asking about
  
  analysis              String?   @db.Text // AI's analysis
  prediction            String?   @db.Text // what might happen if...
  recommendation        String?   @db.Text // what we recommend
  motivationalMessage   String?   @db.Text
  
  actionItems           String?   @db.Text // JSON array of actions
  
  isFollowedUp          Boolean   @default(false)
  followUpDate          DateTime?
  
  createdAt             DateTime  @default(now())
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, createdAt])
  @@map("ai_coach_sessions")
}

enum CoachSessionType {
  BEHAVIOR_ANALYSIS
  PROCRASTINATION_PREDICTION
  TASK_RECOMMENDATION
  DAILY_BRIEF
  WEEKLY_SUMMARY
  BURNOUT_DETECTION
  MOTIVATION_BOOST
  PATTERN_IDENTIFICATION
  PLANNING_ASSISTANCE
  REFLECTION
}

// ==========================================
// ADVANCED FEATURE 9: DYNAMIC AUTO-SCHEDULING
// ==========================================

model ScheduledTask {
  id                    String    @id @default(cuid())
  userId                String
  taskId                String
  
  scheduledStartTime    DateTime
  scheduledEndTime      DateTime
  estimatedDuration     Int       // in minutes
  
  priorityScore         Float     @default(0) // calculated based on deadline, priority, dependencies
  
  isAdjusted            Boolean   @default(false) // was it rescheduled?
  adjustmentReason      String?   // why was it rescheduled?
  
  predictedCompletion   DateTime?
  actualCompletion      DateTime?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, scheduledStartTime])
  @@map("scheduled_tasks")
}

// ==========================================
// ADVANCED FEATURE 10: CALENDAR INTEGRATION
// ==========================================

model CalendarEvent {
  id                    String    @id @default(cuid())
  userId                String
  
  title                 String
  description           String?   @db.Text
  
  startTime             DateTime
  endTime               DateTime
  
  isAllDay              Boolean   @default(false)
  recurrence            String?   // e.g., "DAILY", "WEEKLY"
  
  source                CalendarSource
  externalId            String?   // Google Calendar ID, Outlook ID, etc.
  
  isSynced              Boolean   @default(true)
  lastSyncedAt          DateTime?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId, startTime])
  @@map("calendar_events")
}

enum CalendarSource {
  FOCUSFLOW
  GOOGLE_CALENDAR
  OUTLOOK
  ICAL
}

